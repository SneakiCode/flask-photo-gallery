{% extends 'base.html' %}

{% block title %}Manage Photos{% endblock %}

{% block content %}
    <h1>Manage Uploaded Photos</h1>

    {# Display Page Info #}
    {% if photos and total_pages > 0 %}
    <p style="text-align: center; margin-bottom: 20px;">
        Showing page {{ current_page }} of {{ total_pages }}
    </p>
    {% endif %}

    {% if photos %}
        <div class="photo-management-grid">
            {% for photo in photos %}
                <div class="photo-item">
                    <div class="photo-thumbnail">
                        <img src="{{ url_for('uploaded_file', filename=photo.filename) }}"
                             alt="Thumbnail for {{ photo.filename | e }}"
                             loading="lazy">
                    </div>
                    <div class="photo-details">
                        <p class="caption-preview" title="{{ photo.caption | e }}">
                            {{ photo.caption | e | truncate(60) }}
                        </p>
                    </div>
                    <div class="photo-actions">
                        {# Pass current page to edit link for potentially better redirect back #}
                        <a href="{{ url_for('edit_photo', photo_id=photo.id, page=current_page) }}" class="button edit-button" title="Edit Caption">Edit</a>
                        <form method="post" action="{{ url_for('delete_photo', photo_id=photo.id) }}" style="display: inline;"
                              onsubmit="return confirm('Delete {{ photo.filename | escape | replace("'", "\\'") }}?');">
                              {# Simplified confirm message slightly #}
                            <button type="submit" class="button delete-button" title="Delete Photo">Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>

        {# Pagination Controls #}
        {% if total_pages > 1 %}
        <nav class="pagination" aria-label="Photo navigation">
            <ul>
                {% if current_page > 1 %}
                <li><a href="{{ url_for('manage_photos', page=current_page - 1) }}" class="page-link prev">« Previous</a></li>
                {% else %}
                <li class="disabled"><span class="page-link prev">« Previous</span></li>
                {% endif %}
                {% for page_num in range(1, total_pages + 1) %}
                    {% if page_num == current_page %}
                    <li class="active"><span class="page-link current">{{ page_num }}</span></li>
                    {% else %}
                    <li><a href="{{ url_for('manage_photos', page=page_num) }}" class="page-link">{{ page_num }}</a></li>
                    {% endif %}
                {% endfor %}
                {% if current_page < total_pages %}
                <li><a href="{{ url_for('manage_photos', page=current_page + 1) }}" class="page-link next">Next »</a></li>
                {% else %}
                <li class="disabled"><span class="page-link next">Next »</span></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

    {% else %}
        {# Message shown if no photos exist #}
        <p>No photos found in the database yet.</p>
        <p>Go to the <a href="{{ url_for('upload_page') }}">upload page</a> to add some!</p>
    {% endif %}


    {# --- START: Delete All Section --- #}
    <div class="danger-zone" style="margin-top: 40px; padding-top: 20px; border-top: 3px solid #FF6B6B; text-align: center;">
        <h2>Danger Zone</h2>
        <p style="color: #E05246; font-weight: bold;">Warning: The action below is irreversible!</p>
        <form method="post" action="{{ url_for('delete_all_photos') }}"
              onsubmit="return confirm('ARE YOU ABSOLUTELY SURE?\n\nThis will delete ALL photos and captions PERMANENTLY from the database and remove ALL files from the uploads folder. This cannot be undone!');">
            <button type="submit" class="button delete-button" style="background-color: #D90429; border-color: #3B1D1F; color: white; font-size: 1.1em; padding: 12px 25px;">
                Delete All Photos Forever
            </button>
        </form>
    </div>
    {# --- END: Delete All Section --- #}

{% endblock %} {# End of content block #}